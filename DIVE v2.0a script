--Services
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "DIVE !!! v0.2a script",
   Icon = 0,
   LoadingTitle = "Rayfield Interface Suite",
   LoadingSubtitle = "by Sirius",
   ShowText = "Rayfield",
   Theme = "Default",

   ToggleUIKeybind = "K",

   DisableRayfieldPrompts = false,
   DisableBuildWarnings = false,

   ConfigurationSaving = {
      Enabled = false,
      FolderName = nil,
      FileName = "Big Hub"
   },

   Discord = {
      Enabled = false,
      Invite = "noinvitelink",
      RememberJoins = true
   },

   KeySystem = false,
   KeySettings = {
      Title = "Untitled",
      Subtitle = "Key System",
      Note = "No method of obtaining the key is provided",
      FileName = "Key",
      SaveKey = true,
      GrabKeyFromSite = false,
      Key = {"Hello"}
   }
})

local Tab = Window:CreateTab("settings", 0)

local Section = Tab:CreateSection("Player")

Tab:CreateButton({
   Name = "inf stamina",
   Callback = function()
      while true do
         local char = LocalPlayer.Character
         if char and char:FindFirstChild("Stamina") then
            char.Stamina.Value = 100
         end
         task.wait()
      end
   end,
})

Tab:CreateButton({
   Name = "inf HP",
   Callback = function()
      while true do
         local char = LocalPlayer.Character
         local hum = char and char:FindFirstChild("Humanoid")
         if hum then
            hum.MaxHealth = math.huge
            hum.Health = math.huge
         end
         task.wait()
      end
   end,
})

Tab:CreateButton({
   Name = "inf Mana (Wizard Only)",
   Callback = function()
      while true do
         local char = LocalPlayer.Character
         if char and char:FindFirstChild("Mana") then
            char.Mana.Value = 100
         end
         task.wait()
      end
   end,
})

local Section = Tab:CreateSection("other")

local Button = Tab:CreateButton({
   Name = "Instant interact",
   Callback = function()
   loadstring(game:HttpGet("https://pastebin.com/raw/8PRS0f4t"))()-- The function that takes place when the button is pressed
   end,
})

local Button = Tab:CreateButton({
   Name = "No Fog",
   Callback = function()
      local Lighting = game:GetService("Lighting")
      Lighting.FogEnd = 100000

      for _, v in pairs(Lighting:GetDescendants()) do
         if v:IsA("Atmosphere") then
            v:Destroy()
         end
      end
   end,
})

local Button = Tab:CreateButton({
   Name = "Infinite yield",
   Callback = function()
   loadstring(game:HttpGet("https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source"))()-- The function that takes place when the button is pressed
   end,
})

local Button = Tab:CreateButton({
    Name = "goto the end",
    Callback = function()
        local Exit = workspace.Sections.ShopArea:WaitForChild("Exit")

        local player = game.Players.LocalPlayer
        if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            player.Character.HumanoidRootPart.CFrame = Exit.CFrame + Vector3.new(0, 3, 0)
        end
    end,
})

local AutoFarmEnabled = false
local AutoFarmThread

-- safely fires a proximity prompt for a short time
local function firePromptSafe(prompt, duration)
    if not prompt then return end

    local start = tick()
    while tick() - start < (duration or 1) do
        pcall(function()
            fireproximityprompt(prompt)
        end)
        task.wait(0.1)
    end
end

-- teleports + waits + fires prompt
local function tpAndPrompt(cf, prompt, waitTime)
    local char = player.Character or player.CharacterAdded:Wait()
    local hrp = char:WaitForChild("HumanoidRootPart")

    hrp.CFrame = cf + Vector3.new(0, 3, 0)
    task.wait(waitTime or 0.7)
    firePromptSafe(prompt, 0.8)
end

Tab:CreateToggle({
    Name = "Auto Farm",
    CurrentValue = false,
    Flag = "AutoFarm",
    Callback = function(Value)
        AutoFarmEnabled = Value

        if Value then
            AutoFarmThread = task.spawn(function()
                while AutoFarmEnabled do
                    local Round = workspace:WaitForChild("Round")

                    -- === WAIT FOR ROUND TO START ===
                    while AutoFarmEnabled and not Round.Value do
                        task.wait(0.2)
                    end
                    if not AutoFarmEnabled then break end

                    -- let everything load
                    task.wait(0.7)

                    -- === END BUTTON (START MAP) ===
                    local exit = workspace.Sections.ShopArea:WaitForChild("Exit")
                    local exitPrompt = exit:FindFirstChildWhichIsA("ProximityPrompt", true)

                    tpAndPrompt(exit.CFrame, exitPrompt, 0.7)

                    -- === WAIT FOR MAP FREEZE TO END ===
                    task.wait(0.7)

                    -- === PIVOT 2 ===
                    local pivot2Part = workspace.Sections.ShopArea.Pivots2:GetChildren()[2]
                    local pivot2Prompt =
                        workspace.Sections.ShopArea.Selection2:GetChildren()[2]:FindFirstChild("ProximityPrompt")

                    if pivot2Part and pivot2Prompt then
                        tpAndPrompt(pivot2Part.CFrame, pivot2Prompt, 0.7)
                    end

                    -- === PIVOT 3 (MAY NOT EXIST) ===
                    task.wait(0.7)

                    local pivots3 = workspace.Sections.ShopArea:FindFirstChild("Pivots3")
                    local selection3 = workspace.Sections.ShopArea:FindFirstChild("Selection3")

                    if pivots3 and selection3 then
                        local pivot3Part = pivots3:GetChildren()[2]
                        local pivot3Prompt = selection3:GetChildren()[2]:FindFirstChild("ProximityPrompt")

                        if pivot3Part and pivot3Prompt then
                            tpAndPrompt(pivot3Part.CFrame, pivot3Prompt, 0.7)
                        end
                    end

                    -- === BACK TO END ===
                    task.wait(0.7)
                    tpAndPrompt(exit.CFrame, exitPrompt, 0.7)

                    -- === WAIT FOR ROUND TO END ===
                    while AutoFarmEnabled and Round.Value do
                        task.wait(0.2)
                    end

                    task.wait(0.7)
                end
            end)
        end
    end
})
